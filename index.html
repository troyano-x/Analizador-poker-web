<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analizador de Poker – Web</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 16px; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .col { display: flex; flex-direction: column; gap: 6px; }
    .card { width: 60px; height: 90px; object-fit: contain; border-radius: 6px; border: 1px solid #ddd; }
    .btn { padding: 10px 14px; border: 1px solid #ccc; border-radius: 8px; background: #f6f6f6; cursor: pointer; }
    .btn:hover { background: #eee; }
    h1 { font-size: 20px; margin: 8px 0 12px; }
    label { font-weight: 600; }
    .out { white-space: pre-line; font-weight: 600; margin-top: 6px; }
    .board { display: flex; gap: 8px; align-items: center; }
    select { padding: 6px 8px; border-radius: 8px; border: 1px solid #ccc; }
    input[type="number"] { width: 110px; padding: 6px 8px; border-radius: 8px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Analizador de Poker – Web</h1>

  <div class="row">
    <div class="col">
      <label>Jugador 1</label>
      <div class="row">
        <select id="j1c1"></select>
        <select id="j1c2"></select>
      </div>
      <div class="row">
        <img id="img_j1c1" class="card" />
        <img id="img_j1c2" class="card" />
      </div>
    </div>

    <div class="col">
      <label>Jugador 2</label>
      <div class="row">
        <select id="j2c1"></select>
        <select id="j2c2"></select>
      </div>
      <div class="row">
        <img id="img_j2c1" class="card" />
        <img id="img_j2c2" class="card" />
      </div>
    </div>
  </div>

  <div class="row" style="margin:12px 0;">
    <button class="btn" id="btnMostrar">Mostrar manos</button>
    <button class="btn" id="btnBoardEval">Generar board + Evaluar</button>
    <button class="btn" id="btnLimpiar">Limpiar</button>
  </div>

  <div class="col">
    <label>Board (Flop, Turn, River)</label>
    <div class="board">
      <img id="board0" class="card" />
      <img id="board1" class="card" />
      <img id="board2" class="card" />
      <img id="board3" class="card" />
      <img id="board4" class="card" />
    </div>
  </div>

  <div id="resultado" class="out"></div>

  <div class="row" style="margin-top:12px;">
    <label>Simular (p.e. 1000):</label>
    <input id="sims" type="number" value="1000" min="1" />
    <button class="btn" id="btnSimular">Simular probabilidades</button>
  </div>
  <div id="simu" class="out"></div>

  <script>
    // ====== Config / utilidades ======
    const valores = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const palos = ['C','D','P','T']; // C=Corazones, D=Diamantes, P=Picas, T=Tréboles (nombres de imagen)
    const cartas = []; for (const v of valores) for (const p of palos) cartas.push(v+p);
    const nombrePNG = (code) => `Cartas/${code}.png`;
    const $ = (id) => document.getElementById(id);

    function llenarSelect(sel){
      sel.innerHTML = '<option value="">Carta</option>' + cartas.map(c=>`<option value="${c}">${c}</option>`).join('');
    }
    function mostrarCarta(code, img){ img.src = code ? nombrePNG(code) : ''; }
    function validar(cuatro){
      if (cuatro.some(c => !c)) { alert('❌ Debes seleccionar las 4 cartas (2 por jugador).'); return false; }
      const s = new Set(cuatro); if (s.size !== cuatro.length) { alert('❌ No se pueden repetir cartas entre jugadores.'); return false; }
      return true;
    }
    function barajarBoard(usadas){
      const disp = cartas.filter(c => !usadas.has(c)); const res=[];
      for (let i=0;i<5;i++){ const k=Math.floor(Math.random()*disp.length); res.push(disp[k]); disp.splice(k,1); }
      return res;
    }

    // ====== Evaluador Texas Hold'em (7 cartas -> mejor 5) ======
    const valorA = (v) => v==='A'?14 : v==='K'?13 : v==='Q'?12 : v==='J'?11 : parseInt(v,10);
    function parse(code){ return { r: valorA(code.slice(0,-1)), s: code.slice(-1) }; }
    function uniqueDesc(arr){ return [...new Set(arr)].sort((a,b)=>b-a); }
    function uniqueAsc(arr){ return [...new Set(arr)].sort((a,b)=>a-b); }

    function highestStraight(ranks){
      let u = uniqueAsc(ranks);
      if (u.includes(14)) u = [1, ...u]; // A como 1 para A2345
      let best = 0, run = 1;
      for (let i=1;i<u.length;i++){
        if (u[i] === u[i-1] + 1) { run++; if (run >= 5) best = Math.max(best, u[i] === 1 ? 5 : u[i]); }
        else run = 1;
      }
      return best;
    }

    function best5of7(codes){
      const cards = codes.map(parse);
      const ranks = cards.map(c=>c.r).sort((a,b)=>b-a);
      const cnt = new Map(), suit = new Map();
      for (const c of cards){
        cnt.set(c.r, (cnt.get(c.r)||0)+1);
        if (!suit.has(c.s)) suit.set(c.s, []);
        suit.get(c.s).push(c.r);
      }

      // Flush / Straight Flush
      let flushSuit=null, flushRanks=[];
      for (const [s, arr] of suit){
        if (arr.length >= 5){ flushSuit=s; flushRanks = arr.sort((a,b)=>b-a); break; }
      }
      if (flushSuit){
        const sfHigh = highestStraight(flushRanks);
        if (sfHigh) return { cat:8, tiebreak:[sfHigh], descr:'Escalera color' };
      }

      const groups = {4:[],3:[],2:[],1:[]};
      for (const [r, c] of cnt) groups[c].push(r);
      for (const k of [4,3,2,1]) groups[k].sort((a,b)=>b-a);

      if (groups[4].length){
        const quad = groups[4][0];
        const kick = uniqueDesc(ranks.filter(r=>r!==quad))[0];
        return { cat:7, tiebreak:[quad, kick], descr:'Póker' };
      }
      if (groups[3].length && (groups[2].length || groups[3].length>=2)){
        const triple = groups[3][0];
        const pair   = (groups[3].length>=2) ? groups[3][1] : groups[2][0];
        return { cat:6, tiebreak:[triple, pair], descr:'Full' };
      }
      if (flushSuit){
        const top5 = uniqueDesc(flushRanks).slice(0,5);
        return { cat:5, tiebreak:top5, descr:'Color' };
      }
      const stHigh = highestStraight(ranks);
      if (stHigh){ return { cat:4, tiebreak:[stHigh], descr:'Escalera' }; }
      if (groups[3].length){
        const t = groups[3][0];
        const kickers = uniqueDesc(ranks.filter(r=>r!==t)).slice(0,2);
        return { cat:3, tiebreak:[t, ...kickers], descr:'Trío' };
      }
      if (groups[2].length >= 2){
        const [p1, p2] = groups[2].slice(0,2);
        const kick = uniqueDesc(ranks.filter(r=>r!==p1 && r!==p2))[0];
        return { cat:2, tiebreak:[p1, p2, kick], descr:'Doble par' };
      }
      if (groups[2].length){
        const p = groups[2][0];
        const kicks = uniqueDesc(ranks.filter(r=>r!==p)).slice(0,3);
        return { cat:1, tiebreak:[p, ...kicks], descr:'Par' };
      }
      return { cat:0, tiebreak: uniqueDesc(ranks).slice(0,5), descr:'Carta alta' };
    }

    function compareHands(a,b){
      if (a.cat !== b.cat) return a.cat - b.cat;
      const n = Math.max(a.tiebreak.length, b.tiebreak.length);
      for (let i=0;i<n;i++){
        const va = a.tiebreak[i]||0, vb = b.tiebreak[i]||0;
        if (va !== vb) return va - vb;
      }
      return 0;
    }

    function evaluar(manos, board){
      const h1 = best5of7([...manos[0], ...board]);
      const h2 = best5of7([...manos[1], ...board]);
      const cmp = compareHands(h1, h2);
      if (cmp > 0) return { ganador:1, jugada1:h1.descr, jugada2:h2.descr };
      if (cmp < 0) return { ganador:2, jugada1:h1.descr, jugada2:h2.descr };
      return { ganador:0, jugada1:h1.descr, jugada2:h2.descr };
    }

    // ====== UI ======
    document.addEventListener('DOMContentLoaded', () => {
      ['j1c1','j1c2','j2c1','j2c2'].forEach(id => llenarSelect($(id)));

      $('btnMostrar').onclick = () => {
        const c1=$('j1c1').value, c2=$('j1c2').value, c3=$('j2c1').value, c4=$('j2c2').value;
        if (!validar([c1,c2,c3,c4])) return;
        mostrarCarta(c1,$('img_j1c1')); mostrarCarta(c2,$('img_j1c2'));
        mostrarCarta(c3,$('img_j2c1')); mostrarCarta(c4,$('img_j2c2'));
      };

      let board=[];
      $('btnBoardEval').onclick = () => {
        const c1=$('j1c1').value, c2=$('j1c2').value, c3=$('j2c1').value, c4=$('j2c2').value;
        if (!validar([c1,c2,c3,c4])) return;
        const usadas = new Set([c1,c2,c3,c4]);
        board = barajarBoard(usadas);
        board.forEach((c,i)=>mostrarCarta(c,$('board'+i)));
        const r = evaluar([[c1,c2],[c3,c4]], board);
        $('resultado').textContent =
          r.ganador===1 ? `🏆 Gana Jugador 1 (${r.jugada1})` :
          r.ganador===2 ? `🏆 Gana Jugador 2 (${r.jugada2})` :
                          `🤝 Empate (${r.jugada1})`;
      };

      $('btnSimular').onclick = () => {
        const c1=$('j1c1').value, c2=$('j1c2').value, c3=$('j2c1').value, c4=$('j2c2').value;
        if (!validar([c1,c2,c3,c4])) return;

        let n = parseInt(($('sims').value || '1000'), 10);
        if (!Number.isFinite(n) || n < 1) n = 1000;
        n = Math.min(n, 20000);

        const usadasBase = new Set([c1,c2,c3,c4]);
        let w1=0, w2=0, emp=0;
        for (let k=0;k<n;k++){
          const b = barajarBoard(usadasBase);
          const r = evaluar([[c1,c2],[c3,c4]], b);
          if (r.ganador===1) w1++; else if (r.ganador===2) w2++; else emp++;
        }
        const p1=(w1/n*100).toFixed(2), p2=(w2/n*100).toFixed(2), pe=(emp/n*100).toFixed(2);
        $('simu').textContent = `🧠 ${n} sims\nJugador 1: ${p1}%   |   Jugador 2: ${p2}%   |   Empates: ${pe}%`;
      };

      $('btnLimpiar').onclick = () => {
        ['j1c1','j1c2','j2c1','j2c2'].forEach(id => $(id).value = '');
        ['img_j1c1','img_j1c2','img_j2c1','img_j2c2','board0','board1','board2','board3','board4']
          .forEach(id => $(id).src = '');
        $('resultado').textContent = '';
        $('simu').textContent = '';
        board = [];
      };
    });
  </script>
</body>
</html>
