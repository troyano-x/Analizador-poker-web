<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analizador de Poker – Web</title>
  <style>
    /* ===== Mesa de póker (tema) + diseño responsivo ===== */
    :root{
      --cardW: clamp(56px, 9.5vw, 96px);
      --radius: clamp(28px, 5vw, 48px);
      --pad: clamp(14px, 3.2vw, 26px);
      --felt-1:#1f7a4a;  --felt-2:#0f5a37;  --felt-3:#063b25;
      --wood-1:#7b4b2a;  --wood-2:#5c361d;  --wood-3:#3d2414;
      --ink:#ffffff;     --ink-dim:#e8f3ed; --line:#cfe9df;
    }
    body{
      margin: 0; font-family: system-ui, Arial, sans-serif; color: var(--ink);
      background: radial-gradient(1200px 700px at 50% -10%, #0a3a28 0%, #042218 60%, #031912 100%);
    }
    .page{ padding: clamp(8px, 2.5vw, 20px); }
    .table{
      max-width: 1100px; margin: 0 auto; padding: var(--pad);
      border-radius: calc(var(--radius) + 16px); position: relative;
      background:
        radial-gradient(1200px 700px at 50% 20%, rgba(255,255,255,.10), rgba(0,0,0,.18) 70%) ,
        radial-gradient(600px 400px at 30% 30%, rgba(255,255,255,.06), transparent 70%),
        radial-gradient(600px 400px at 70% 70%, rgba(255,255,255,.05), transparent 70%),
        radial-gradient(circle at 50% 50%, var(--felt-1) 0%, var(--felt-2) 55%, var(--felt-3) 100%);
      box-shadow: 0 18px 40px rgba(0,0,0,.55), inset 0 2px 6px rgba(255,255,255,.10),
                  inset 0 -6px 18px rgba(0,0,0,.45);
    }
    .table::before{
      content:""; position:absolute; inset: calc(var(--pad) * -0.9);
      border-radius: calc(var(--radius) + 28px);
      background: linear-gradient(180deg, var(--wood-1), var(--wood-2) 45%, var(--wood-2) 60%, var(--wood-3));
      box-shadow: 0 20px 45px rgba(0,0,0,.6), inset 0 2px 3px rgba(255,255,255,.25),
                  inset 0 -3px 6px rgba(0,0,0,.55);
      z-index:-1;
    }
    h1{ font-size: clamp(22px, 3.2vw, 34px); margin: 0 0 14px; }
    h2{ font-size: clamp(18px, 2.4vw, 22px); margin: 6px 0; color: var(--ink-dim); }
    h3{ font-size: clamp(16px, 2.1vw, 20px); margin: 10px 0; color: var(--ink-dim); }
    .grid-players{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: clamp(10px, 2vw, 22px); }
    @media (max-width: 720px){ .grid-players{ grid-template-columns: 1fr; } }
    .row{ display:flex; gap: 10px; align-items:center; flex-wrap:wrap; }
    .col{ display:flex; flex-direction:column; gap: 8px; }
    .btn{
      padding: 12px 16px; border-radius: 14px; border:1px solid rgba(255,255,255,.25);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: var(--ink); cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.15);
      touch-action: manipulation;
    }
    .btn:hover{ filter: brightness(1.06); }
    .btn:active{ transform: translateY(1px); }

    /* Cartas visibles (slots y board) */
    .card{
      width: var(--cardW); height: calc(var(--cardW) * 1.5); object-fit: contain;
      border-radius: 10px; border: 1px solid rgba(255,255,255,.35);
      box-shadow: 0 6px 12px rgba(0,0,0,.35); background: rgba(255,255,255,.08);
    }
    .cards-row{ display:flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .slot{
      width: var(--cardW); height: calc(var(--cardW)*1.5); border-radius: 12px; border: 1px dashed rgba(255,255,255,.35);
      background: rgba(255,255,255,.07); color: var(--ink-dim); display:grid; place-items:center;
      font-weight:700; cursor:pointer; box-shadow: inset 0 1px 0 rgba(255,255,255,.1);
    }
    .slot:hover{ background: rgba(255,255,255,.10); }

    /* ===== Modal selector de cartas ===== */
    .picker-backdrop{
      position: fixed; inset: 0; background: rgba(0,0,0,.55); display: none; z-index: 10;
      align-items: center; justify-content: center; padding: 16px;
    }
    .picker-backdrop.open{ display:flex; }
    .picker{
      width: min(1000px, 100%); max-height: 90vh; overflow: auto; border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.25); box-shadow: 0 16px 40px rgba(0,0,0,.6);
      padding: 14px;
    }
    .picker-header{ display:flex; align-items:center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
    .picker-title{ font-weight:700; }
    .picker-grid{
      display:grid; grid-template-columns: repeat(auto-fit, minmax(var(--cardW), 1fr)); gap: 10px;
    }
    .pick-btn{
      border: 1px solid rgba(255,255,255,.35); border-radius: 10px; background: rgba(255,255,255,.08);
      padding: 0; cursor:pointer; display:block;
      box-shadow: 0 6px 12px rgba(0,0,0,.35);
    }
    .pick-btn img{ width: 100%; height: calc(var(--cardW) * 1.5); object-fit: contain; display:block; border-radius: 10px; }
    .pick-btn[disabled]{ filter: grayscale(1) brightness(.7); cursor:not-allowed; opacity: .6; }
    .picker-actions{ display:flex; gap:10px; justify-content:flex-end; margin-top: 10px; }
    .btn-secondary{ background: rgba(255,255,255,.08); }
  </style>
</head>
<body>
  <div class="page">
    <div class="table">
      <h1>Analizador de Poker – Web</h1>

      <section class="grid-players">
        <div class="col">
          <h2>Jugador 1</h2>
          <!-- Slots clicables -->
          <div class="cards-row">
            <button class="slot" data-slot="j1c1" title="Elegir carta J1-1">Elegir</button>
            <button class="slot" data-slot="j1c2" title="Elegir carta J1-2">Elegir</button>
          </div>
          <!-- Vista de cartas elegidas -->
          <div class="cards-row">
            <img id="img_j1c1" class="card" />
            <img id="img_j1c2" class="card" />
          </div>
        </div>

        <div class="col">
          <h2>Jugador 2</h2>
          <div class="cards-row">
            <button class="slot" data-slot="j2c1" title="Elegir carta J2-1">Elegir</button>
            <button class="slot" data-slot="j2c2" title="Elegir carta J2-2">Elegir</button>
          </div>
          <div class="cards-row">
            <img id="img_j2c1" class="card" />
            <img id="img_j2c2" class="card" />
          </div>
        </div>
      </section>

      <div class="row" style="margin: clamp(10px,2vw,18px) 0;">
        <button class="btn" id="btnMostrar">Mostrar manos</button>
        <button class="btn" id="btnBoardEval">Generar board + Evaluar</button>
        <button class="btn" id="btnLimpiar">Limpiar</button>
      </div>

      <section>
        <h3>Board (Flop, Turn, River)</h3>
        <div class="cards-row">
          <img id="board0" class="card" />
          <img id="board1" class="card" />
          <img id="board2" class="card" />
          <img id="board3" class="card" />
          <img id="board4" class="card" />
        </div>
      </section>

      <div id="resultado" class="out"></div>

      <section class="row" style="margin-top: clamp(8px,2vw,12px);">
        <label>Simular (p.e. 1000):</label>
        <input id="sims" type="number" value="1000" min="1" />
        <button class="btn" id="btnSimular">Simular probabilidades</button>
      </section>
      <div id="simu" class="out"></div>

      <!-- Inputs ocultos para compatibilidad con la lógica existente -->
      <input id="j1c1" type="hidden"><input id="j1c2" type="hidden">
      <input id="j2c1" type="hidden"><input id="j2c2" type="hidden">
    </div>
  </div>

  <!-- ===== Modal selector de cartas ===== -->
  <div class="picker-backdrop" id="pickerBackdrop" aria-hidden="true">
    <div class="picker" role="dialog" aria-modal="true">
      <div class="picker-header">
        <div class="picker-title" id="pickerTitle">Elige una carta</div>
        <button class="btn btn-secondary" id="btnClosePicker">Cerrar</button>
      </div>
      <div class="picker-grid" id="pickerGrid"></div>
      <div class="picker-actions">
        <button class="btn btn-secondary" id="btnClearSlot">Quitar carta</button>
        <button class="btn" id="btnAcceptPicker">Aceptar</button>
      </div>
    </div>
  </div>

  <script>
    /* ====== LÓGICA ====== */
    const valores = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const palos = ['C','D','P','T'];
    const cartas = []; for (const v of valores) for (const p of palos) cartas.push(v+p);
    const nombrePNG = (code) => `Cartas/${code}.png`;
    const $ = (id) => document.getElementById(id);

    // ---- Picker visual ----
    let currentSlot = null;   // 'j1c1' | 'j1c2' | 'j2c1' | 'j2c2'
    let tempChoice  = null;   // elección temporal en el modal

    // botones de los slots
    document.querySelectorAll('.slot').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        openPicker(btn.dataset.slot);
      });
    });

    function getUsedSet(exceptSlot=null){
      const ids = ['j1c1','j1c2','j2c1','j2c2'].filter(id => id !== exceptSlot);
      const set = new Set();
      ids.forEach(id => { const v=$(id).value; if (v) set.add(v); });
      return set;
    }

    function openPicker(slot){
      currentSlot = slot;
      tempChoice  = $(slot).value || null;
      $('pickerTitle').textContent = `Elige una carta (${slot.toUpperCase()})`;
      const used = getUsedSet(slot);
      const grid = $('pickerGrid');
      grid.innerHTML = '';
      cartas.forEach(code=>{
        const b = document.createElement('button');
        b.className = 'pick-btn';
        b.type = 'button';
        b.title = code;
        b.innerHTML = `<img src="${nombrePNG(code)}" alt="${code}">`;
        if (used.has(code)) b.disabled = true;
        if (tempChoice === code) b.style.outline = '3px solid #cfe9df';
        b.addEventListener('click', ()=>{
          tempChoice = code;
          // marcar selección visualmente
          [...grid.querySelectorAll('.pick-btn')].forEach(x=>x.style.outline='none');
          b.style.outline = '3px solid #cfe9df';
        });
        grid.appendChild(b);
      });
      $('pickerBackdrop').classList.add('open');
      $('pickerBackdrop').setAttribute('aria-hidden','false');
    }

    function closePicker(){
      $('pickerBackdrop').classList.remove('open');
      $('pickerBackdrop').setAttribute('aria-hidden','true');
      currentSlot = null; tempChoice = null;
    }

    $('btnClosePicker').onclick = closePicker;
    $('btnAcceptPicker').onclick = ()=>{
      if (!currentSlot || !tempChoice) { closePicker(); return; }
      setSlotValue(currentSlot, tempChoice);
      closePicker();
    };
    $('btnClearSlot').onclick = ()=>{
      if (!currentSlot) return;
      setSlotValue(currentSlot, '');
      closePicker();
    };
    // cerrar al clickear fuera
    $('pickerBackdrop').addEventListener('click', (e)=>{
      if (e.target.id === 'pickerBackdrop') closePicker();
    });

    function setSlotValue(slot, code){
      $(slot).value = code || '';
      const imgId = 'img_'+slot;
      const slotBtn = document.querySelector(`.slot[data-slot="${slot}"]`);
      if (code){
        document.getElementById(imgId).src = nombrePNG(code);
        slotBtn.textContent = code;
      }else{
        document.getElementById(imgId).src = '';
        slotBtn.textContent = 'Elegir';
      }
    }

    function mostrarCarta(code, img){ img.src = code ? nombrePNG(code) : ''; }
    function validar(cuatro){
      if (cuatro.some(c => !c)) { alert('❌ Debes seleccionar las 4 cartas (2 por jugador).'); return false; }
      const s = new Set(cuatro); if (s.size !== cuatro.length) { alert('❌ No se pueden repetir cartas entre jugadores.'); return false; }
      return true;
    }
    function barajarBoard(usadas){
      const disp = cartas.filter(c => !usadas.has(c)); const res=[];
      for (let i=0;i<5;i++){ const k=Math.floor(Math.random()*disp.length); res.push(disp[k]); disp.splice(k,1); }
      return res;
    }

    // ===== Evaluador Texas Hold'em (7 -> mejor 5) =====
    const valorA = (v) => v==='A'?14 : v==='K'?13 : v==='Q'?12 : v==='J'?11 : parseInt(v,10);
    function parse(code){ return { r: valorA(code.slice(0,-1)), s: code.slice(-1) }; }
    function uniqueDesc(arr){ return [...new Set(arr)].sort((a,b)=>b-a); }
    function uniqueAsc(arr){ return [...new Set(arr)].sort((a,b)=>a-b); }
    function highestStraight(ranks){
      let u = uniqueAsc(ranks);
      if (u.includes(14)) u = [1, ...u];
      let best = 0, run = 1;
      for (let i=1;i<u.length;i++){
        if (u[i] === u[i-1] + 1) { run++; if (run >= 5) best = Math.max(best, u[i] === 1 ? 5 : u[i]); }
        else run = 1;
      }
      return best;
    }
    function best5of7(codes){
      const cards = codes.map(parse);
      const ranks = cards.map(c=>c.r).sort((a,b)=>b-a);
      const cnt = new Map(), suit = new Map();
      for (const c of cards){
        cnt.set(c.r, (cnt.get(c.r)||0)+1);
        if (!suit.has(c.s)) suit.set(c.s, []);
        suit.get(c.s).push(c.r);
      }
      let flushSuit=null, flushRanks=[];
      for (const [s, arr] of suit){
        if (arr.length >= 5){ flushSuit=s; flushRanks = arr.sort((a,b)=>b-a); break; }
      }
      if (flushSuit){
        const sfHigh = highestStraight(flushRanks);
        if (sfHigh) return { cat:8, tiebreak:[sfHigh], descr:'Escalera color' };
      }
      const groups = {4:[],3:[],2:[],1:[]};
      for (const [r, c] of cnt) groups[c].push(r);
      for (const k of [4,3,2,1]) groups[k].sort((a,b)=>b-a);
      if (groups[4].length){
        const quad = groups[4][0];
        const kick = uniqueDesc(ranks.filter(r=>r!==quad))[0];
        return { cat:7, tiebreak:[quad, kick], descr:'Póker' };
      }
      if (groups[3].length && (groups[2].length || groups[3].length>=2)){
        const triple = groups[3][0];
        const pair   = (groups[3].length>=2) ? groups[3][1] : groups[2][0];
        return { cat:6, tiebreak:[triple, pair], descr:'Full' };
      }
      if (flushSuit){
        const top5 = uniqueDesc(flushRanks).slice(0,5);
        return { cat:5, tiebreak:top5, descr:'Color' };
      }
      const stHigh = highestStraight(ranks);
      if (stHigh){ return { cat:4, tiebreak:[stHigh], descr:'Escalera' }; }
      if (groups[3].length){
        const t = groups[3][0];
        const kickers = uniqueDesc(ranks.filter(r=>r!==t)).slice(0,2);
        return { cat:3, tiebreak:[t, ...kickers], descr:'Trío' };
      }
      if (groups[2].length >= 2){
        const [p1, p2] = groups[2].slice(0,2);
        const kick = uniqueDesc(ranks.filter(r=>r!==p1 && r!==p2))[0];
        return { cat:2, tiebreak:[p1, p2, kick], descr:'Doble par' };
      }
      if (groups[2].length){
        const p = groups[2][0];
        const kicks = uniqueDesc(ranks.filter(r=>r!==p)).slice(0,3);
        return { cat:1, tiebreak:[p, ...kicks], descr:'Par' };
      }
      return { cat:0, tiebreak: uniqueDesc(ranks).slice(0,5), descr:'Carta alta' };
    }
    function compareHands(a,b){
      if (a.cat !== b.cat) return a.cat - b.cat;
      const n = Math.max(a.tiebreak.length, b.tiebreak.length);
      for (let i=0;i<n;i++){
        const va = a.tiebreak[i]||0, vb = b.tiebreak[i]||0;
        if (va !== vb) return va - vb;
      }
      return 0;
    }
    function evaluar(manos, board){
      const h1 = best5of7([...manos[0], ...board]);
      const h2 = best5of7([...manos[1], ...board]);
      const cmp = compareHands(h1, h2);
      if (cmp > 0) return { ganador:1, jugada1:h1.descr, jugada2:h2.descr };
      if (cmp < 0) return { ganador:2, jugada1:h1.descr, jugada2:h2.descr };
      return { ganador:0, jugada1:h1.descr, jugada2:h2.descr };
    }

    // ---- Botones principales ----
    $('btnMostrar').onclick = () => {
      const c1=$('j1c1').value, c2=$('j1c2').value, c3=$('j2c1').value, c4=$('j2c2').value;
      if (!validar([c1,c2,c3,c4])) return;
      mostrarCarta(c1,$('img_j1c1')); mostrarCarta(c2,$('img_j1c2'));
      mostrarCarta(c3,$('img_j2c1')); mostrarCarta(c4,$('img_j2c2'));
    };
    $('btnBoardEval').onclick = () => {
      const c1=$('j1c1').value, c2=$('j1c2').value, c3=$('j2c1').value, c4=$('j2c2').value;
      if (!validar([c1,c2,c3,c4])) return;
      const usadas = new Set([c1,c2,c3,c4]);
      const board = barajarBoard(usadas);
      [0,1,2,3,4].forEach(i => mostrarCarta(board[i], $('board'+i)));
      const r = evaluar([[c1,c2],[c3,c4]], board);
      $('resultado').textContent =
        r.ganador===1 ? `🏆 Gana Jugador 1 (${r.jugada1})` :
        r.ganador===2 ? `🏆 Gana Jugador 2 (${r.jugada2})` :
                        `🤝 Empate (${r.jugada1})`;
    };
    $('btnSimular').onclick = () => {
      const c1=$('j1c1').value, c2=$('j1c2').value, c3=$('j2c1').value, c4=$('j2c2').value;
      if (!validar([c1,c2,c3,c4])) return;
      let n = parseInt(($('sims').value || '1000'), 10);
      if (!Number.isFinite(n) || n < 1) n = 1000;
      n = Math.min(n, 20000);
      const usadasBase = new Set([c1,c2,c3,c4]);
      let w1=0, w2=0, emp=0;
      for (let k=0;k<n;k++){
        const b = barajarBoard(usadasBase);
        const r = evaluar([[c1,c2],[c3,c4]], b);
        if (r.ganador===1) w1++; else if (r.ganador===2) w2++; else emp++;
      }
      const p1=(w1/n*100).toFixed(2), p2=(w2/n*100).toFixed(2), pe=(emp/n*100).toFixed(2);
      $('simu').textContent = `🧠 ${n} sims\nJugador 1: ${p1}%   |   Jugador 2: ${p2}%   |   Empates: ${pe}%`;
    };
    $('btnLimpiar').onclick = () => {
      ['j1c1','j1c2','j2c1','j2c2'].forEach(id => setSlotValue(id,''));
      ['board0','board1','board2','board3','board4'].forEach(id => $(id).src='');
      $('resultado').textContent = ''; $('simu').textContent = '';
    };
  </script>
</body>
</html>
